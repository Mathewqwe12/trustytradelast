# Список ошибок для исправления

## Бэкенд

### 1. Проблемы с Python 3.13

- Несовместимость SQLAlchemy с Python 3.13

```
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes
```

- Несовместимость Pydantic с Python 3.13

```
TypeError: ForwardRef._evaluate() missing 1 required keyword-only argument: 'recursive_guard'
```

### 2. Проблемы с виртуальным окружением

- Отсутствуют зависимости в окружении

```
ModuleNotFoundError: No module named 'fastapi'
```

### 3. Проблемы с API и обработкой ошибок

- Отсутствует централизованная обработка ошибок в FastAPI
- HTTPException выбрасываются напрямую в роутерах без обработки:
  - `/accounts`: 404 ошибки при не найденных аккаунтах/пользователях
  - `/auth/telegram`: Ошибки валидации Telegram данных
- Недостаточное логирование ошибок в `test_backend.py`

### 4. Проблемы с безопасностью

- Hardcoded credentials в `alembic.ini`:
  - Database URL содержит пароль в plaintext
  - Нужно перенести в переменные окружения

## Фронтенд

### 1. Проблемы с API клиентом

- Несогласованность URL API:
  - В начале файла: `http://localhost:8000/api`
  - В конструкторе: `http://localhost:8000/api/v1`
- Отсутствует обработка токена авторизации в заголовках
- Недостаточная обработка ошибок в API ответах:

```typescript
catch (error) {
  console.error('API Error:', error);
  return {
    status: 'error',
    error: error instanceof Error ? error.message : 'Unknown error',
  };
}
```

### 2. Проблемы с Telegram Web App

- Ошибка доступа к приватному методу `init()` в `TelegramService`
- Отсутствует типизация для некоторых методов Telegram Web App
- Требуется улучшение обработки ошибок в Telegram callbacks

### 3. Проблемы с UI компонентами

- Дублирование стилей для `.error-message` в `main.css`
- Повторяющийся код обработки ошибок в компонентах:
  - `HomePage.ts`
  - `AccountDetailsPage.ts`
- Отсутствует единый компонент для отображения ошибок

## План исправления

### Бэкенд

1. Откатиться на Python 3.11:

   - Создать новое виртуальное окружение
   - Обновить requirements.txt с совместимыми версиями
   - Переустановить зависимости

2. Улучшить обработку ошибок:
   - Создать централизованный обработчик ошибок
   - Добавить middleware для логирования
   - Стандартизировать формат ошибок API

### Фронтенд

1. Рефакторинг API клиента:

   - Исправить URL API
   - Улучшить обработку ошибок
   - Добавить типы для всех ответов

2. Улучшить работу с Telegram Web App:

   - Удалить ручной вызов `init()`
   - Добавить недостающие типы
   - Улучшить обработку ошибок

3. Улучшить компоненты:
   - Создать общий компонент для ошибок
   - Удалить дублирование кода
   - Исправить стили

### Общие задачи

1. Настроить линтеры для проверки кода
2. Добавить автоматические тесты
3. Настроить CI/CD для проверки кода
4. Улучшить документацию по обработке ошибок
